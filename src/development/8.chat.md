# Chat

## Scheduled chat message

### Background

We need a way for admin/coordinator to schedule a message to the cohort wide chat channel. It should also be editable.

### Key logic

* DB change
  * Add new db fields "scheduled"(datetime), "is_sent"(boolean) to chat log table.
* Create/update scheduled message
  * Use the normal create message API, adding a parameter "scheduled" with a datetime string.
  * Create a new API to update a message, including the scheduled time and the message itself.
* Cronjob
  * A cronjob that checks db regularly for every X minutes.
  * Checks if there are past scheduled message that hasn't been sent. If so, change the "is_sent" to true and send the Pusher event.
  * Send unread chat reminder email to user when there are unread chat messages and he didn’t see it within 10 minutes.
  * Only send one email to the user before he checks the chat.

### Tasks

* [CORE] Create migration to add field "scheduled", "is_sent" to chat log table.
* [Chat API] Able to pass scheduled time when create message.
* [Chat API] Filter the chat messages that are scheduled later.
* [Chat API] Create API to update a message.
* [CORE] New unread chat reminder email (new reminder email logic, send Pusher event if a passed scheduled message hasn’t been sent).
* [CUTIE] UI to allow schedule cohort wide message.
